From 211de7d9e713a47c61ab1b689bb9584dc38db7fb Mon Sep 17 00:00:00 2001
From: Victor Bo <bvoid@yandex.ru>
Date: Sat, 19 Feb 2022 23:43:31 +0000
Subject: [PATCH 61/80] add dump_logs helper

---
 phh-prop-handler.sh | 12 ++++++++++++
 vndk.rc             |  3 +++
 2 files changed, 15 insertions(+)

diff --git a/phh-prop-handler.sh b/phh-prop-handler.sh
index 019bb4d..2106fc8 100644
--- a/phh-prop-handler.sh
+++ b/phh-prop-handler.sh
@@ -286,6 +286,18 @@ if [ "$1" == "sys.phh.restart_sysui" ]; then
     exit
 fi
 
+#dump_logs
+if [ "$1" == "sys.phh.dump_logs" ]; then
+    if [[ "$prop_value" = "false" && "$prop_value" != "true" ]]; then
+        exit
+    fi
+
+    if [[ "$prop_value" == "true" ]]; then
+        logcat -b all -d > /sdcard/logs.txt
+    fi
+    exit
+fi
+
 if [ "$1" == "persist.sys.phh.disable_soundvolume_effect" ];then
     if [[ "$prop_value" != "0" && "$prop_value" != "1" ]]; then
         exit 1
diff --git a/vndk.rc b/vndk.rc
index 9550589..e39a66e 100644
--- a/vndk.rc
+++ b/vndk.rc
@@ -83,6 +83,9 @@ on property:persist.sys.phh.nolog=*
 on property:sys.phh.restart_sysui=*
     exec u:r:phhsu_daemon:s0 root -- /system/bin/phh-prop-handler.sh "sys.phh.restart_sysui"
 
+on property:sys.phh.dump_logs=*
+    exec u:r:phhsu_daemon:s0 root -- /system/bin/phh-prop-handler.sh "sys.phh.dump_logs"
+
 on property:init.svc.ril-proxy=stopped && property:persist.sys.phh.restart_ril=true
     start ril-proxy
 
-- 
2.25.1

